# トラブルシューティング

## よくある問題と解決方法

### 画像が表示されない

#### 症状
- 特定のブラウザや環境で画像が表示されない
- コンソールに 400 Bad Request エラー

#### 原因
- CloudinaryのURLに日本語が含まれている
- NFD（分解形式）でエンコードされた文字が含まれている

#### 解決方法
1. 英数字のみのファイル名でCloudinaryに再アップロード
2. 全ページで古いURLを新しいURLに置換

```bash
# 全ページで古いURLを検索
grep -r "古いURL" src/

# 一括置換（VSCodeの検索置換機能を使用）
```

---

### Astroのビルドエラー

#### 症状
- `npm run dev` または `npm run build` でエラー
- "Expected ':' but found" などの構文エラー

#### よくある原因と解決方法

**1. 属性値内の引用符がエスケープされていない**
```html
<!-- ❌ 間違い -->
<Layout description="これは"テスト"です">

<!-- ✅ 正しい -->
<Layout description="これは&quot;テスト&quot;です">
```

**2. HTMLコメント内のAstro構文**
```html
<!-- ❌ 間違い -->
<!-- {variable} -->

<!-- ✅ 正しい -->
<!-- 変数の値 -->
```

**3. スタイルブロック内の構文エラー**
- CSSの閉じ括弧忘れ
- セレクタの書き間違い

---

### ページの内容が古い／反映されない

#### 症状
- コードを変更したのに表示が変わらない
- 古いバージョンが表示される

#### 解決方法

**1. 開発サーバーの再起動**
```bash
# Ctrl+C で停止
npm run dev
```

**2. ブラウザキャッシュのクリア**
- Chrome: Cmd+Shift+R（Mac）/ Ctrl+Shift+R（Windows）
- 強制リロード

**3. ビルドキャッシュのクリア**
```bash
rm -rf dist/
rm -rf .astro/
npm run build
```

---

### モバイルメニューが動作しない

#### 症状
- ハンバーガーメニューがクリックできない
- メニューが開閉しない

#### 確認ポイント

1. **JavaScriptが読み込まれているか**
   - ブラウザのコンソールでエラーを確認

2. **クラス名が正しいか**
   - `.hamburger`
   - `.mobile-menu`
   - `.mobile-menu-backdrop`

3. **Zインデックスの競合**
   - モバイルメニュー: z-index: 4000
   - ハンバーガーボタン: z-index: 4200
   - バックドロップ: z-index: 3500

---

### フォントが表示されない

#### 症状
- CraftMinchoフォントが適用されない
- デフォルトフォントで表示される

#### 確認ポイント

1. **フォントファイルの配置**
```
public/assets/fonts/craftmincho.otf
```

2. **@font-face定義の確認**
```css
@font-face {
  font-family: 'CraftMincho';
  src: url('/assets/fonts/craftmincho.otf') format('opentype');
  font-display: swap;
}
```

3. **パスの確認**
- Astroでは `/` から始まる絶対パス
- `public/` ディレクトリがルート

---

### レイアウトが崩れる

#### 症状
- モバイルでレイアウトが崩れる
- 特定の画面サイズで表示がおかしい

#### 確認ポイント

1. **レスポンシブブレークポイント**
```css
@media(max-width: 768px) { /* モバイル */ }
@media(max-width: 900px) { /* タブレット */ }
@media(min-width: 880px) { /* PC */ }
```

2. **Grid/Flexboxの設定**
- `grid-template-columns` の確認
- `flex-wrap` の設定

3. **コンテナの最大幅**
```css
.container {
  max-width: 1240px;
  margin: 0 auto;
  padding: 0 32px;
}
```

---

## デバッグのコツ

### 1. ブラウザの開発者ツール
- Elements: HTML構造とスタイルの確認
- Console: JavaScriptエラーの確認
- Network: 画像やファイルの読み込み状況
- Lighthouse: パフォーマンスとSEOのチェック

### 2. Astro Dev Tools
```bash
# 詳細なログ出力
npm run dev -- --verbose
```

### 3. ビルドチェック
```bash
# 本番ビルドで問題を確認
npm run build
npm run preview
```

### 4. Git diff で変更確認
```bash
# 最後のコミットからの変更
git diff

# 特定ファイルの差分
git diff src/pages/index.astro
```

---

## 緊急時の復旧方法

### コンテンツが失われた場合

1. **レガシーバックアップを確認**
```
Public_legacy_backup/
```

2. **Git履歴から復元**
```bash
# ファイル履歴を確認
git log --follow -- path/to/file

# 特定のコミットの内容を確認
git show <commit-hash>:path/to/file

# ファイルを復元
git checkout <commit-hash> -- path/to/file
```

3. **Vercelのデプロイ履歴**
- Vercel ダッシュボードから以前のデプロイを確認
- 必要に応じてロールバック

---

## サポートリソース

- **Astro公式ドキュメント**: https://docs.astro.build/
- **Cloudinary公式ドキュメント**: https://cloudinary.com/documentation
- **制作マニュアル**: `/Users/masaya/Desktop/Github/Corduroy/WEBSITE/制作マニュアル/`
